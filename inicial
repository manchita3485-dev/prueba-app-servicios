<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sistema de Control de Mantenimiento Vehicular</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  <style id="app-style">
    /* Custom Styles */
    :root {
      --primary-color: #1e40af;
      --secondary-color: #1e3a8a;
      --accent-color: #3b82f6;
      --light-gray: #f3f4f6;
      --dark-gray: #4b5563;
      --danger: #ef4444;
      --success: #10b981;
      --warning: #f59e0b;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9fafb;
      min-height: 100vh;
    }
    
    .login-container {
      background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
      min-height: 100vh;
    }
    
    .login-card {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      border-radius: 1rem;
    }
    
    .app-header {
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .logo-text {
      background: linear-gradient(45deg, #fff, #e2e8f0);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 700;
    }
    
    .side-menu {
      background-color: white;
      border-right: 1px solid #e5e7eb;
      transition: all 0.3s ease;
      height: calc(100vh - 64px);
      overflow-y: auto;
    }
    
    .menu-item {
      border-radius: 0.375rem;
      transition: all 0.2s ease;
    }
    
    .menu-item:hover {
      background-color: var(--light-gray);
    }
    
    .menu-item.active {
      background-color: #dbeafe;
      color: var(--primary-color);
    }
    
    .content-area {
      min-height: calc(100vh - 64px);
      background-color: #f9fafb;
      transition: all 0.3s ease;
    }
    
    .card {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .table-header {
      background-color: #f8fafc;
    }
    
    .overdue {
      color: var(--danger);
      font-weight: 600;
    }
    
    .btn-primary {
      background-color: var(--primary-color);
      transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
      background-color: var(--secondary-color);
    }
    
    .btn-secondary {
      background-color: var(--dark-gray);
      transition: all 0.2s ease;
    }
    
    .btn-danger {
      background-color: var(--danger);
      transition: all 0.2s ease;
    }
    
    .btn-success {
      background-color: var(--success);
      transition: all 0.2s ease;
    }
    
    .signature-pad {
      border: 1px dashed #ccc;
      border-radius: 0.5rem;
      background-color: #fff;
      touch-action: none;
    }
    
    .form-label {
      color: var(--dark-gray);
      font-weight: 500;
    }
    
    .form-input {
      border-color: #e5e7eb;
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      width: 100%;
    }
    
    .form-input:focus {
      border-color: var(--accent-color);
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    
    .filter-controls {
      background-color: #fff;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    @media print {
      .no-print {
        display: none !important;
      }
      .print-content {
        display: block !important;
        width: 100% !important;
      }
    }
    
    /* Animations */
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Custom checkbox styling */
    .custom-checkbox {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 1.5rem;
      height: 1.5rem;
      border: 2px solid #cbd5e0;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .custom-checkbox.checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }
    
    .custom-checkbox.checked.bad {
      background-color: var(--danger);
      border-color: var(--danger);
    }
    
    .custom-checkbox.checked.na {
      background-color: var(--dark-gray);
      border-color: var(--dark-gray);
    }
  </style>
</head>
<body>
  <!-- Login Section -->
  <div id="login-section" class="login-container flex items-center justify-center w-full">
    <div class="login-card w-full max-w-md p-8 animate__animated animate__fadeIn">
      <div class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-primary-600">
          <i class="fas fa-car-alt text-blue-700 mr-2"></i>
          Sistema de Control Vehicular
        </h1>
        <p class="mt-2 text-gray-600">Ingrese sus credenciales para continuar</p>
      </div>
      <form id="login-form">
        <div class="mb-4">
          <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Usuario</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <i class="fas fa-user"></i>
            </span>
            <input type="text" id="username" name="username" required
              class="pl-10 form-input border border-gray-300 rounded-lg py-2 px-4 w-full"
              placeholder="Ingrese su usuario">
          </div>
        </div>
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <i class="fas fa-lock"></i>
            </span>
            <input type="password" id="password" name="password" required
              class="pl-10 form-input border border-gray-300 rounded-lg py-2 px-4 w-full"
              placeholder="Ingrese su contraseña">
          </div>
        </div>
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition">
          Iniciar Sesión <i class="fas fa-sign-in-alt ml-2"></i>
        </button>
        <div id="login-error" class="mt-4 text-red-600 text-center hidden"></div>
      </form>
    </div>
  </div>

  <!-- Main Application Layout -->
  <div id="app-container" class="hidden flex flex-col h-screen">
    <!-- Header -->
    <header class="app-header text-white py-4 px-6">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center">
          <i class="fas fa-car-alt text-2xl mr-2"></i>
          <span class="logo-text text-xl">Sistema de Control de Mantenimiento Vehicular</span>
        </div>
        <div class="flex items-center space-x-4">
          <span id="user-info" class="text-sm hidden md:inline-block">
            <i class="fas fa-user mr-1"></i> <span id="current-user">Usuario</span>
          </span>
          <button id="logout-btn" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-sm">
            <i class="fas fa-sign-out-alt mr-1"></i> Cerrar Sesión
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar -->
      <aside class="side-menu w-64 hidden md:block shadow-md z-10">
        <nav class="py-4 px-2">
          <div class="px-4 py-2 text-lg font-semibold text-gray-600 mb-2">Menú Principal</div>
          <ul class="space-y-1">
            <li>
              <a href="javascript:void(0)" data-page="dashboard" class="menu-item active flex items-center px-4 py-2 text-gray-700">
                <i class="fas fa-tachometer-alt w-6"></i>
                <span>Panel Principal</span>
              </a>
            </li>
            <li>
              <a href="javascript:void(0)" data-page="service" class="menu-item flex items-center px-4 py-2 text-gray-700">
                <i class="fas fa-tools w-6"></i>
                <span>Registrar Servicio</span>
              </a>
            </li>
            <li>
              <a href="javascript:void(0)" data-page="checklist" class="menu-item flex items-center px-4 py-2 text-gray-700">
                <i class="fas fa-clipboard-check w-6"></i>
                <span>Lista de Chequeo</span>
              </a>
            </li>
            <li>
              <a href="javascript:void(0)" data-page="reports" class="menu-item flex items-center px-4 py-2 text-gray-700">
                <i class="fas fa-file-alt w-6"></i>
                <span>Reportes</span>
              </a>
            </li>
            <li id="admin-users-menu" class="hidden">
              <a href="javascript:void(0)" data-page="users" class="menu-item flex items-center px-4 py-2 text-gray-700">
                <i class="fas fa-users-cog w-6"></i>
                <span>Gestión de Usuarios</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Mobile menu button -->
      <button id="mobile-menu-button" class="md:hidden fixed bottom-4 right-4 z-20 bg-blue-600 text-white rounded-full p-3 shadow-lg">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Mobile menu -->
      <div id="mobile-menu" class="fixed inset-0 bg-gray-800 bg-opacity-75 z-50 hidden">
        <div class="bg-white h-full w-64 p-4">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-bold">Menú</h2>
            <button id="close-mobile-menu" class="text-gray-600">
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>
          <nav>
            <ul class="space-y-2">
              <li>
                <a href="javascript:void(0)" data-page="dashboard" class="mobile-menu-item flex items-center px-4 py-2 text-gray-700 rounded hover:bg-gray-100">
                  <i class="fas fa-tachometer-alt w-6"></i>
                  <span>Panel Principal</span>
                </a>
              </li>
              <li>
                <a href="javascript:void(0)" data-page="service" class="mobile-menu-item flex items-center px-4 py-2 text-gray-700 rounded hover:bg-gray-100">
                  <i class="fas fa-tools w-6"></i>
                  <span>Registrar Servicio</span>
                </a>
              </li>
              <li>
                <a href="javascript:void(0)" data-page="checklist" class="mobile-menu-item flex items-center px-4 py-2 text-gray-700 rounded hover:bg-gray-100">
                  <i class="fas fa-clipboard-check w-6"></i>
                  <span>Lista de Chequeo</span>
                </a>
              </li>
              <li>
                <a href="javascript:void(0)" data-page="reports" class="mobile-menu-item flex items-center px-4 py-2 text-gray-700 rounded hover:bg-gray-100">
                  <i class="fas fa-file-alt w-6"></i>
                  <span>Reportes</span>
                </a>
              </li>
              <li id="mobile-admin-users-menu" class="hidden">
                <a href="javascript:void(0)" data-page="users" class="mobile-menu-item flex items-center px-4 py-2 text-gray-700 rounded hover:bg-gray-100">
                  <i class="fas fa-users-cog w-6"></i>
                  <span>Gestión de Usuarios</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <!-- Content Area -->
      <main class="content-area flex-1 p-4 md:p-6 overflow-y-auto">
        <!-- Dynamic content will be loaded here -->
        
        <!-- Dashboard Page -->
        <section id="dashboard-page" class="page-content animate__animated animate__fadeIn">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Panel Principal</h1>
            <p class="text-gray-600">Control de vehículos y servicios de mantenimiento</p>
          </div>

          <!-- Stats Summary -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <div class="card p-4 flex items-center">
              <div class="bg-blue-100 p-3 rounded-full mr-4">
                <i class="fas fa-car text-blue-600 text-xl"></i>
              </div>
              <div>
                <p class="text-gray-500 text-sm">Vehículos Registrados</p>
                <p class="text-xl font-bold" id="total-vehicles">--</p>
              </div>
            </div>
            <div class="card p-4 flex items-center">
              <div class="bg-green-100 p-3 rounded-full mr-4">
                <i class="fas fa-tools text-green-600 text-xl"></i>
              </div>
              <div>
                <p class="text-gray-500 text-sm">Servicios Realizados</p>
                <p class="text-xl font-bold" id="total-services">--</p>
              </div>
            </div>
            <div class="card p-4 flex items-center">
              <div class="bg-red-100 p-3 rounded-full mr-4">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
              </div>
              <div>
                <p class="text-gray-500 text-sm">Servicios Vencidos</p>
                <p class="text-xl font-bold" id="overdue-services">--</p>
              </div>
            </div>
          </div>

          <!-- Vehicle List -->
          <div class="card mb-4">
            <div class="p-4 border-b flex justify-between items-center">
              <h2 class="text-lg font-semibold text-gray-700">Lista de Vehículos</h2>
              <div class="flex space-x-2">
                <input type="text" id="vehicle-search" placeholder="Buscar..." 
                  class="border border-gray-300 rounded px-3 py-1 text-sm">
                <button id="add-vehicle-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex items-center">
                  <i class="fas fa-plus mr-1"></i> Agregar
                </button>
              </div>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="table-header">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Placa
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Piloto
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Último Servicio
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Km Actual
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Próximo Servicio (Km)
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Estado
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Acciones
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="vehicle-table-body">
                  <!-- Vehicle data will be loaded here -->
                  <tr>
                    <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                      Cargando vehículos...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Service Registration Page -->
        <section id="service-page" class="page-content animate__animated animate__fadeIn hidden">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Registro de Servicio</h1>
            <p class="text-gray-600">Registre un nuevo servicio de mantenimiento para un vehículo</p>
          </div>

          <div class="card p-6">
            <form id="service-form">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- License Plate -->
                <div class="mb-4">
                  <label for="license-plate" class="form-label block mb-1">Placa del Vehículo</label>
                  <div class="flex space-x-2">
                    <select id="license-plate" name="license-plate" class="form-input flex-1">
                      <option value="">-- Seleccionar placa --</option>
                      <option value="new">+ Ingresar nueva placa</option>
                    </select>
                  </div>
                </div>

                <!-- New License Plate (conditional) -->
                <div id="new-plate-container" class="mb-4 hidden">
                  <label for="new-license-plate" class="form-label block mb-1">Nueva Placa</label>
                  <input type="text" id="new-license-plate" name="new-license-plate" class="form-input" placeholder="Ingrese la placa">
                </div>

                <!-- Pilot Name -->
                <div class="mb-4">
                  <label for="pilot-name" class="form-label block mb-1">Nombre del Piloto</label>
                  <input type="text" id="pilot-name" name="pilot-name" class="form-input" placeholder="Nombre del piloto">
                </div>

                <!-- Service Date -->
                <div class="mb-4">
                  <label for="service-date" class="form-label block mb-1">Fecha de Servicio</label>
                  <div class="relative">
                    <input type="text" id="service-date" name="service-date" class="form-input" placeholder="Seleccione la fecha">
                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                      <i class="fas fa-calendar"></i>
                    </span>
                  </div>
                </div>

                <!-- Current KM -->
                <div class="mb-4">
                  <label for="current-km" class="form-label block mb-1">Kilometraje Actual</label>
                  <input type="number" id="current-km" name="current-km" class="form-input" placeholder="Km actual">
                </div>

                <!-- Next Service KM -->
                <div class="mb-4">
                  <label for="next-service-km" class="form-label block mb-1">Kilometraje Próximo Servicio</label>
                  <input type="number" id="next-service-km" name="next-service-km" class="form-input" placeholder="Km próximo servicio">
                </div>

                <!-- Observations -->
                <div class="mb-4 md:col-span-2">
                  <label for="service-observations" class="form-label block mb-1">Observaciones</label>
                  <textarea id="service-observations" name="service-observations" rows="3" class="form-input resize-none" placeholder="Ingrese cualquier observación relevante"></textarea>
                </div>
              </div>

              <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="cancel-service-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Cancelar
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                  Guardar Servicio
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- Checklist Page -->
        <section id="checklist-page" class="page-content animate__animated animate__fadeIn hidden">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Lista de Chequeo</h1>
            <p class="text-gray-600">Complete la lista de verificación del vehículo</p>
          </div>

          <div class="card p-6">
            <form id="checklist-form">
              <div class="mb-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- License Plate -->
                <div class="mb-4">
                  <label for="checklist-license-plate" class="form-label block mb-1">Placa del Vehículo</label>
                  <select id="checklist-license-plate" name="checklist-license-plate" class="form-input" required>
                    <option value="">-- Seleccionar placa --</option>
                  </select>
                </div>

                <!-- Date -->
                <div class="mb-4">
                  <label for="checklist-date" class="form-label block mb-1">Fecha de Inspección</label>
                  <div class="relative">
                    <input type="text" id="checklist-date" name="checklist-date" class="form-input" placeholder="Seleccione la fecha" required>
                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                      <i class="fas fa-calendar"></i>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Checklist Table -->
              <div class="mb-8 overflow-x-auto">
                <table class="min-w-full border border-gray-200">
                  <thead>
                    <tr class="bg-gray-100">
                      <th class="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Ítem</th>
                      <th class="py-2 px-4 border-b text-center text-sm font-medium text-gray-700">Buen Estado</th>
                      <th class="py-2 px-4 border-b text-center text-sm font-medium text-gray-700">Mal Estado</th>
                      <th class="py-2 px-4 border-b text-center text-sm font-medium text-gray-700">N/A</th>
                      <th class="py-2 px-4 border-b text-left text-sm font-medium text-gray-700">Observaciones</th>
                    </tr>
                  </thead>
                  <tbody id="checklist-items">
                    <!-- Items will be added here dynamically -->
                  </tbody>
                </table>
              </div>

              <!-- Signature Pad -->
              <div class="mb-6">
                <label class="form-label block mb-1">Firma de Inspección</label>
                <div class="flex flex-col items-center space-y-3">
                  <canvas id="signature-pad" class="signature-pad w-full max-w-md h-48 mb-2"></canvas>
                  <div class="flex space-x-2">
                    <button type="button" id="clear-signature" class="px-3 py-1 text-sm border border-gray-300 rounded bg-white text-gray-700">
                      <i class="fas fa-eraser mr-1"></i> Limpiar firma
                    </button>
                  </div>
                </div>
              </div>

              <div class="mt-6 flex justify-end space-x-3">
                <button type="button" id="cancel-checklist-btn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50">
                  Cancelar
                </button>
                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                  Guardar Inspección
                </button>
              </div>
            </form>
          </div>
        </section>

        <!-- Reports Page -->
        <section id="reports-page" class="page-content animate__animated animate__fadeIn hidden">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Reportes</h1>
            <p class="text-gray-600">Genere reportes de servicios y mantenimiento por vehículo o piloto</p>
          </div>

          <div class="filter-controls p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
              <div>
                <label for="report-filter-type" class="form-label block mb-1 text-sm">Filtrar por:</label>
                <select id="report-filter-type" class="form-input">
                  <option value="plate">Placa del Vehículo</option>
                  <option value="pilot">Nombre del Piloto</option>
                </select>
              </div>
              <div id="report-filter-plate-container">
                <label for="report-filter-plate" class="form-label block mb-1 text-sm">Placa:</label>
                <select id="report-filter-plate" class="form-input">
                  <option value="">-- Todas las placas --</option>
                </select>
              </div>
              <div id="report-filter-pilot-container" class="hidden">
                <label for="report-filter-pilot" class="form-label block mb-1 text-sm">Piloto:</label>
                <select id="report-filter-pilot" class="form-input">
                  <option value="">-- Todos los pilotos --</option>
                </select>
              </div>
              <div class="md:col-span-2 flex items-end">
                <button id="generate-report-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                  <i class="fas fa-search mr-1"></i> Generar Reporte
                </button>
                <button id="print-report-btn" class="ml-2 px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 hidden">
                  <i class="fas fa-print mr-1"></i> Imprimir
                </button>
              </div>
            </div>
          </div>

          <div id="report-results" class="card hidden">
            <div class="p-4 border-b">
              <h2 class="text-lg font-semibold text-gray-700">Resultados del Reporte</h2>
              <p id="report-summary" class="text-sm text-gray-500 mt-1"></p>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="table-header">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Placa
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Piloto
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Fecha
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Km Actual
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Próximo Servicio
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Estado
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Observaciones
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="report-table-body">
                  <!-- Report data will be loaded here -->
                </tbody>
              </table>
            </div>
            <div id="no-report-data" class="p-8 text-center text-gray-500 hidden">
              No se encontraron registros para los criterios seleccionados
            </div>
          </div>
        </section>

        <!-- User Management Page (Admin only) -->
        <section id="users-page" class="page-content animate__animated animate__fadeIn hidden">
          <div class="mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Gestión de Usuarios</h1>
            <p class="text-gray-600">Administre los usuarios del sistema</p>
          </div>

          <div class="card mb-4">
            <div class="p-4 border-b flex justify-between items-center">
              <h2 class="text-lg font-semibold text-gray-700">Lista de Usuarios</h2>
              <button id="add-user-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex items-center">
                <i class="fas fa-plus mr-1"></i> Nuevo Usuario
              </button>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="table-header">
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Nombre
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Usuario
                    </th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Rol
                    </th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Acciones
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="users-table-body">
                  <!-- User data will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- Modal Components -->
  <!-- Generic Modal Container -->
  <div id="modal-container" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden animate__animated animate__fadeIn">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
      <div id="modal-content">
        <!-- Modal content will be dynamically inserted here -->
      </div>
    </div>
  </div>

  <!-- Add/Edit Vehicle Modal Content -->
  <div id="vehicle-modal-content" class="hidden">
    <div class="border-b px-6 py-4">
      <h3 class="text-lg font-medium text-gray-900" id="vehicle-modal-title">Agregar Vehículo</h3>
    </div>
    <form id="vehicle-form">
      <div class="px-6 py-4">
        <div class="mb-4">
          <label for="modal-license-plate" class="form-label block mb-1">Placa</label>
          <input type="text" id="modal-license-plate" name="license-plate" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-pilot-name" class="form-label block mb-1">Nombre del Piloto</label>
          <input type="text" id="modal-pilot-name" name="pilot-name" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-current-km" class="form-label block mb-1">Kilometraje Actual</label>
          <input type="number" id="modal-current-km" name="current-km" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-next-service-km" class="form-label block mb-1">Kilometraje Próximo Servicio</label>
          <input type="number" id="modal-next-service-km" name="next-service-km" class="form-input" required>
        </div>
      </div>
      <div class="bg-gray-50 px-6 py-3 flex justify-end">
        <button type="button" class="modal-cancel px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 mr-2">
          Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          Guardar
        </button>
      </div>
    </form>
  </div>

  <!-- Add/Edit User Modal Content -->
  <div id="user-modal-content" class="hidden">
    <div class="border-b px-6 py-4">
      <h3 class="text-lg font-medium text-gray-900" id="user-modal-title">Agregar Usuario</h3>
    </div>
    <form id="user-form">
      <div class="px-6 py-4">
        <div class="mb-4">
          <label for="modal-fullname" class="form-label block mb-1">Nombre Completo</label>
          <input type="text" id="modal-fullname" name="fullname" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-username" class="form-label block mb-1">Nombre de Usuario</label>
          <input type="text" id="modal-username" name="username" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-password" class="form-label block mb-1">Contraseña</label>
          <input type="password" id="modal-password" name="password" class="form-input" required>
        </div>
        <div class="mb-4">
          <label for="modal-role" class="form-label block mb-1">Rol</label>
          <select id="modal-role" name="role" class="form-input" required>
            <option value="admin">Administrador</option>
            <option value="guest">Invitado</option>
          </select>
        </div>
      </div>
      <div class="bg-gray-50 px-6 py-3 flex justify-end">
        <button type="button" class="modal-cancel px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 mr-2">
          Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
          Guardar
        </button>
      </div>
    </form>
  </div>

  <!-- Confirmation Modal Content -->
  <div id="confirm-modal-content" class="hidden">
    <div class="border-b px-6 py-4">
      <h3 class="text-lg font-medium text-gray-900" id="confirm-modal-title">Confirmar Acción</h3>
    </div>
    <div class="px-6 py-4">
      <p id="confirm-modal-message">¿Está seguro que desea realizar esta acción?</p>
    </div>
    <div class="bg-gray-50 px-6 py-3 flex justify-end">
      <button type="button" id="confirm-modal-cancel" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 mr-2">
        Cancelar
      </button>
      <button type="button" id="confirm-modal-confirm" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
        Confirmar
      </button>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg hidden animate__animated animate__fadeInUp z-50">
    <div class="flex items-center space-x-2">
      <i id="toast-icon" class="fas fa-check-circle"></i>
      <span id="toast-message"></span>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
  <script id="app-script">
    // App state and initialization
    document.addEventListener('DOMContentLoaded', function() {
      // Default admin user if none exists
      if (!localStorage.getItem('users')) {
        const defaultAdmin = {
          fullname: 'Administrador',
          username: 'admin',
          password: 'admin123',
          role: 'admin'
        };
        localStorage.setItem('users', JSON.stringify([defaultAdmin]));
      }
      
      // Initialize default checklist items if none exist
      if (!localStorage.getItem('checklistItems')) {
        const defaultItems = [
          'Luces delanteras',
          'Luces traseras',
          'Luces de freno',
          'Direccionales',
          'Limpia parabrisas',
          'Nivel de aceite',
          'Nivel de refrigerante',
          'Estado de llantas',
          'Presión de llantas',
          'Frenos',
          'Cinturones de seguridad',
          'Espejos',
          'Bocina',
          'Documentos del vehículo',
          'Kit de emergencia'
        ];
        localStorage.setItem('checklistItems', JSON.stringify(defaultItems));
      }

      // Login functionality
      const loginForm = document.getElementById('login-form');
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.username === username && u.password === password);
        
        if (user) {
          // Store current user in session storage
          sessionStorage.setItem('currentUser', JSON.stringify({
            username: user.username,
            fullname: user.fullname,
            role: user.role
          }));
          
          // Show admin options if user is admin
          if (user.role === 'admin') {
            document.getElementById('admin-users-menu').classList.remove('hidden');
            document.getElementById('mobile-admin-users-menu').classList.remove('hidden');
          }
          
          // Update UI
          document.getElementById('current-user').textContent = user.fullname;
          document.getElementById('login-section').classList.add('hidden');
          document.getElementById('app-container').classList.remove('hidden');
          
          // Load initial data
          loadDashboard();
        } else {
          const errorDiv = document.getElementById('login-error');
          errorDiv.textContent = 'Usuario o contraseña incorrectos';
          errorDiv.classList.remove('hidden');
        }
      });
      
      // Logout functionality
      document.getElementById('logout-btn').addEventListener('click', function() {
        sessionStorage.removeItem('currentUser');
        document.getElementById('login-section').classList.remove('hidden');
        document.getElementById('app-container').classList.add('hidden');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('login-error').classList.add('hidden');
      });
      
      // Navigation
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach(item => {
        item.addEventListener('click', function() {
          const page = this.getAttribute('data-page');
          switchPage(page);
          
          // Update active menu
          menuItems.forEach(mi => mi.classList.remove('active'));
          this.classList.add('active');
          
          // Close mobile menu if open
          document.getElementById('mobile-menu').classList.add('hidden');
        });
      });
      
      // Mobile menu
      document.getElementById('mobile-menu-button').addEventListener('click', function() {
        document.getElementById('mobile-menu').classList.remove('hidden');
      });
      
      document.getElementById('close-mobile-menu').addEventListener('click', function() {
        document.getElementById('mobile-menu').classList.add('hidden');
      });
      
      const mobileMenuItems = document.querySelectorAll('.mobile-menu-item');
      mobileMenuItems.forEach(item => {
        item.addEventListener('click', function() {
          const page = this.getAttribute('data-page');
          switchPage(page);
          
          // Update active menu in desktop view too
          menuItems.forEach(mi => {
            if (mi.getAttribute('data-page') === page) {
              mi.classList.add('active');
            } else {
              mi.classList.remove('active');
            }
          });
          
          // Close mobile menu
          document.getElementById('mobile-menu').classList.add('hidden');
        });
      });
      
      // Modal close buttons
      document.querySelectorAll('.modal-cancel').forEach(button => {
        button.addEventListener('click', closeModal);
      });
      
      // Initialize date pickers
      flatpickr("#service-date", {
        dateFormat: "Y-m-d",
        defaultDate: "today"
      });
      
      flatpickr("#checklist-date", {
        dateFormat: "Y-m-d",
        defaultDate: "today"
      });
      
      // License plate dropdown logic
      document.getElementById('license-plate').addEventListener('change', function() {
        const newPlateContainer = document.getElementById('new-plate-container');
        if (this.value === 'new') {
          newPlateContainer.classList.remove('hidden');
        } else {
          newPlateContainer.classList.add('hidden');
          if (this.value) {
            // Auto-fill pilot name based on selected vehicle
            const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
            const vehicle = vehicles.find(v => v.licensePlate === this.value);
            if (vehicle) {
              document.getElementById('pilot-name').value = vehicle.pilotName;
              document.getElementById('current-km').value = vehicle.currentKm;
            }
          }
        }
      });
      
      // Dashboard add vehicle button
      document.getElementById('add-vehicle-btn').addEventListener('click', function() {
        showVehicleModal();
      });
      
      // Vehicle form submission
      document.getElementById('vehicle-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveVehicle();
      });
      
      // User management
      document.getElementById('add-user-btn').addEventListener('click', function() {
        showUserModal();
      });
      
      // User form submission
      document.getElementById('user-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveUser();
      });
      
      // Service form cancel button
      document.getElementById('cancel-service-btn').addEventListener('click', function() {
        switchPage('dashboard');
        document.querySelector('.menu-item[data-page="dashboard"]').classList.add('active');
        document.querySelector('.menu-item[data-page="service"]').classList.remove('active');
      });
      
      // Service form submission
      document.getElementById('service-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveService();
      });
      
      // Checklist page setup
      initChecklistPage();
      
      // Checklist form cancel button
      document.getElementById('cancel-checklist-btn').addEventListener('click', function() {
        switchPage('dashboard');
        document.querySelector('.menu-item[data-page="dashboard"]').classList.add('active');
        document.querySelector('.menu-item[data-page="checklist"]').classList.remove('active');
      });
      
      // Checklist form submission
      document.getElementById('checklist-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveChecklist();
      });
      
      // Reports page
      document.getElementById('report-filter-type').addEventListener('change', function() {
        const plateContainer = document.getElementById('report-filter-plate-container');
        const pilotContainer = document.getElementById('report-filter-pilot-container');
        
        if (this.value === 'plate') {
          plateContainer.classList.remove('hidden');
          pilotContainer.classList.add('hidden');
        } else {
          plateContainer.classList.add('hidden');
          pilotContainer.classList.remove('hidden');
        }
      });
      
      // Generate report button
      document.getElementById('generate-report-btn').addEventListener('click', generateReport);
      
      // Print report button
      document.getElementById('print-report-btn').addEventListener('click', function() {
        window.print();
      });
      
      // Initialize signature pad for checklist
      let signaturePad;
      document.getElementById('clear-signature').addEventListener('click', function() {
        if (signaturePad) signaturePad.clear();
      });
      
      // Function to initialize signature pad
      function initSignaturePad() {
        const canvas = document.getElementById('signature-pad');
        signaturePad = new SignaturePad(canvas, {
          backgroundColor: 'rgba(255, 255, 255, 0)',
          penColor: 'blue'
        });
        
        // Resize canvas for better display
        function resizeCanvas() {
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          canvas.width = canvas.offsetWidth * ratio;
          canvas.height = canvas.offsetHeight * ratio;
          canvas.getContext("2d").scale(ratio, ratio);
          signaturePad.clear(); // Clear the canvas
        }
        
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();
      }
      
      // Vehicle search functionality
      document.getElementById('vehicle-search').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#vehicle-table-body tr');
        
        rows.forEach(row => {
          const licensePlate = row.querySelector('td:first-child')?.textContent.toLowerCase() || '';
          const pilotName = row.querySelector('td:nth-child(2)')?.textContent.toLowerCase() || '';
          
          if (licensePlate.includes(searchTerm) || pilotName.includes(searchTerm)) {
            row.classList.remove('hidden');
          } else {
            row.classList.add('hidden');
          }
        });
      });
      
      // Helper Functions
      function switchPage(pageName) {
        // Hide all pages
        document.querySelectorAll('.page-content').forEach(page => {
          page.classList.add('hidden');
        });
        
        // Show selected page
        const selectedPage = document.getElementById(`${pageName}-page`);
        if (selectedPage) {
          selectedPage.classList.remove('hidden');
          
          // Page-specific initializations
          if (pageName === 'dashboard') {
            loadDashboard();
          } else if (pageName === 'service') {
            loadServiceForm();
          } else if (pageName === 'checklist') {
            loadChecklistForm();
            // Initialize signature pad when checklist page is shown
            setTimeout(initSignaturePad, 100);
          } else if (pageName === 'reports') {
            loadReportFilters();
          } else if (pageName === 'users') {
            loadUsers();
          }
        }
      }
      
      function loadDashboard() {
        // Load vehicle stats
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        document.getElementById('total-vehicles').textContent = vehicles.length;
        
        const services = JSON.parse(localStorage.getItem('services') || '[]');
        document.getElementById('total-services').textContent = services.length;
        
        let overdueCount = 0;
        vehicles.forEach(vehicle => {
          if (parseInt(vehicle.currentKm) >= parseInt(vehicle.nextServiceKm)) {
            overdueCount++;
          }
        });
        document.getElementById('overdue-services').textContent = overdueCount;
        
        // Load vehicle table
        const tableBody = document.getElementById('vehicle-table-body');
        tableBody.innerHTML = '';
        
        if (vehicles.length === 0) {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td colspan="7" class="px-4 py-4 text-center text-gray-500">
              No hay vehículos registrados
            </td>
          `;
          tableBody.appendChild(row);
        } else {
          vehicles.forEach(vehicle => {
            const isOverdue = parseInt(vehicle.currentKm) >= parseInt(vehicle.nextServiceKm);
            const lastService = services.filter(s => s.licensePlate === vehicle.licensePlate)
              .sort((a, b) => new Date(b.serviceDate) - new Date(a.serviceDate))[0];
            
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="px-4 py-3 whitespace-nowrap">${vehicle.licensePlate}</td>
              <td class="px-4 py-3">${vehicle.pilotName}</td>
              <td class="px-4 py-3">${lastService ? lastService.serviceDate : 'N/A'}</td>
              <td class="px-4 py-3">${vehicle.currentKm} km</td>
              <td class="px-4 py-3">${vehicle.nextServiceKm} km</td>
              <td class="px-4 py-3">
                ${isOverdue ? 
                  '<span class="overdue"><i class="fas fa-exclamation-circle mr-1"></i> Vencido</span>' : 
                  '<span class="text-green-600"><i class="fas fa-check-circle mr-1"></i> Al día</span>'}
              </td>
              <td class="px-4 py-3 text-right">
                <button class="text-blue-600 hover:text-blue-800 mr-3 edit-vehicle" data-plate="${vehicle.licensePlate}">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="text-red-600 hover:text-red-800 delete-vehicle" data-plate="${vehicle.licensePlate}">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </td>
            `;
            tableBody.appendChild(row);
          });
          
          // Add event listeners for edit/delete buttons
          document.querySelectorAll('.edit-vehicle').forEach(btn => {
            btn.addEventListener('click', function() {
              const plate = this.getAttribute('data-plate');
              editVehicle(plate);
            });
          });
          
          document.querySelectorAll('.delete-vehicle').forEach(btn => {
            btn.addEventListener('click', function() {
              const plate = this.getAttribute('data-plate');
              confirmDeleteVehicle(plate);
            });
          });
        }
      }
      
      function loadServiceForm() {
        // Reset form
        document.getElementById('service-form').reset();
        document.getElementById('new-plate-container').classList.add('hidden');
        
        // Populate license plate dropdown
        const licensePlateSelect = document.getElementById('license-plate');
        licensePlateSelect.innerHTML = '<option value="">-- Seleccionar placa --</option>' +
                                      '<option value="new">+ Ingresar nueva placa</option>';
        
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        vehicles.forEach(vehicle => {
          const option = document.createElement('option');
          option.value = vehicle.licensePlate;
          option.textContent = vehicle.licensePlate;
          licensePlateSelect.appendChild(option);
        });
      }
      
      function loadChecklistForm() {
        // Reset form
        document.getElementById('checklist-form').reset();
        
        // Populate license plate dropdown
        const licensePlateSelect = document.getElementById('checklist-license-plate');
        licensePlateSelect.innerHTML = '<option value="">-- Seleccionar placa --</option>';
        
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        vehicles.forEach(vehicle => {
          const option = document.createElement('option');
          option.value = vehicle.licensePlate;
          option.textContent = vehicle.licensePlate;
          licensePlateSelect.appendChild(option);
        });
        
        // Load checklist items
        const items = JSON.parse(localStorage.getItem('checklistItems') || '[]');
        const tableBody = document.getElementById('checklist-items');
        tableBody.innerHTML = '';
        
        items.forEach((item, index) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="py-2 px-4 border-b">${item}</td>
            <td class="py-2 px-4 border-b text-center">
              <div class="custom-checkbox mx-auto" data-index="${index}" data-status="good">
                <i class="fas fa-check hidden"></i>
              </div>
            </td>
            <td class="py-2 px-4 border-b text-center">
              <div class="custom-checkbox mx-auto" data-index="${index}" data-status="bad">
                <i class="fas fa-times hidden"></i>
              </div>
            </td>
            <td class="py-2 px-4 border-b text-center">
              <div class="custom-checkbox mx-auto" data-index="${index}" data-status="na">
                <i class="fas fa-minus hidden"></i>
              </div>
            </td>
            <td class="py-2 px-4 border-b">
              <input type="text" class="form-input text-sm py-1" name="observation-${index}" placeholder="Observación">
            </td>
          `;
          tableBody.appendChild(row);
        });
        
        // Add event listeners to checkboxes
        document.querySelectorAll('.custom-checkbox').forEach(checkbox => {
          checkbox.addEventListener('click', function() {
            const index = this.getAttribute('data-index');
            const status = this.getAttribute('data-status');
            
            // Uncheck all checkboxes in the same row
            document.querySelectorAll(`.custom-checkbox[data-index="${index}"]`).forEach(cb => {
              cb.classList.remove('checked');
              cb.querySelector('i').classList.add('hidden');
            });
            
            // Check the clicked checkbox
            this.classList.add('checked');
            if (status === 'bad') this.classList.add('bad');
            if (status === 'na') this.classList.add('na');
            this.querySelector('i').classList.remove('hidden');
          });
        });
      }
      
      function initChecklistPage() {
        // This function sets up the initial checklist page
        const items = JSON.parse(localStorage.getItem('checklistItems') || '[]');
        if (items.length === 0) {
          // If no items in storage, we'll populate with default items
          // (But this should already be handled in the initial setup)
        }
      }
      
      function loadReportFilters() {
        // Populate plate filter
        const plateSelect = document.getElementById('report-filter-plate');
        plateSelect.innerHTML = '<option value="">-- Todas las placas --</option>';
        
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        vehicles.forEach(vehicle => {
          const option = document.createElement('option');
          option.value = vehicle.licensePlate;
          option.textContent = vehicle.licensePlate;
          plateSelect.appendChild(option);
        });
        
        // Populate pilot filter
        const pilotSelect = document.getElementById('report-filter-pilot');
        pilotSelect.innerHTML = '<option value="">-- Todos los pilotos --</option>';
        
        // Get unique pilot names
        const pilots = [...new Set(vehicles.map(vehicle => vehicle.pilotName))];
        pilots.forEach(pilot => {
          const option = document.createElement('option');
          option.value = pilot;
          option.textContent = pilot;
          pilotSelect.appendChild(option);
        });
        
        // Hide report results initially
        document.getElementById('report-results').classList.add('hidden');
        document.getElementById('print-report-btn').classList.add('hidden');
      }
      
      function generateReport() {
        const filterType = document.getElementById('report-filter-type').value;
        let filterValue;
        let filterName;
        
        if (filterType === 'plate') {
          filterValue = document.getElementById('report-filter-plate').value;
          filterName = 'placa';
        } else {
          filterValue = document.getElementById('report-filter-pilot').value;
          filterName = 'piloto';
        }
        
        // Get all services
        let services = JSON.parse(localStorage.getItem('services') || '[]');
        
        // Filter by selected criteria
        if (filterValue) {
          if (filterType === 'plate') {
            services = services.filter(service => service.licensePlate === filterValue);
          } else {
            services = services.filter(service => service.pilotName === filterValue);
          }
        }
        
        // Sort by date (newest first)
        services.sort((a, b) => new Date(b.serviceDate) - new Date(a.serviceDate));
        
        // Update report summary
        const summary = document.getElementById('report-summary');
        if (filterValue) {
          summary.textContent = `Filtrando por ${filterName}: ${filterValue}`;
        } else {
          summary.textContent = 'Mostrando todos los registros';
        }
        
        // Update report table
        const tableBody = document.getElementById('report-table-body');
        tableBody.innerHTML = '';
        
        if (services.length === 0) {
          document.getElementById('no-report-data').classList.remove('hidden');
          document.getElementById('report-results').classList.remove('hidden');
          document.getElementById('print-report-btn').classList.add('hidden');
        } else {
          document.getElementById('no-report-data').classList.add('hidden');
          document.getElementById('report-results').classList.remove('hidden');
          document.getElementById('print-report-btn').classList.remove('hidden');
          
          services.forEach(service => {
            const isOverdue = parseInt(service.currentKm) >= parseInt(service.nextServiceKm);
            const checklistStatus = service.checklist ? 'Completada' : 'No completada';
            
            const row = document.createElement('tr');
            row.innerHTML = `
              <td class="px-4 py-3">${service.licensePlate}</td>
              <td class="px-4 py-3">${service.pilotName}</td>
              <td class="px-4 py-3">${service.serviceDate}</td>
              <td class="px-4 py-3">${service.currentKm} km</td>
              <td class="px-4 py-3">${service.nextServiceKm} km</td>
              <td class="px-4 py-3">
                ${isOverdue ? 
                  '<span class="text-red-600"><i class="fas fa-exclamation-circle mr-1"></i> Vencido</span>' : 
                  '<span class="text-green-600"><i class="fas fa-check-circle mr-1"></i> Al día</span>'}
              </td>
              <td class="px-4 py-3">${service.observations || 'Sin observaciones'}</td>
            `;
            tableBody.appendChild(row);
          });
        }
      }
      
      function loadUsers() {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const tableBody = document.getElementById('users-table-body');
        tableBody.innerHTML = '';
        
        users.forEach(user => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="px-4 py-3">${user.fullname}</td>
            <td class="px-4 py-3">${user.username}</td>
            <td class="px-4 py-3">
              <span class="px-2 py-1 rounded text-xs ${user.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                ${user.role === 'admin' ? 'Administrador' : 'Invitado'}
              </span>
            </td>
            <td class="px-4 py-3 text-right">
              <button class="text-blue-600 hover:text-blue-800 mr-3 edit-user" data-username="${user.username}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="text-red-600 hover:text-red-800 delete-user" data-username="${user.username}">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          `;
          tableBody.appendChild(row);
        });
        
        // Add event listeners for edit/delete buttons
        document.querySelectorAll('.edit-user').forEach(btn => {
          btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            editUser(username);
          });
        });
        
        document.querySelectorAll('.delete-user').forEach(btn => {
          btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            confirmDeleteUser(username);
          });
        });
      }
      
      // Modal Functions
      function showModal(contentId) {
        const modalContainer = document.getElementById('modal-container');
        const modalContent = document.getElementById('modal-content');
        const content = document.getElementById(contentId).innerHTML;
        
        modalContent.innerHTML = content;
        modalContainer.classList.remove('hidden');
        
        // Add event listeners to newly added cancel buttons
        modalContainer.querySelectorAll('.modal-cancel').forEach(btn => {
          btn.addEventListener('click', closeModal);
        });
      }
      
      function closeModal() {
        document.getElementById('modal-container').classList.add('hidden');
      }
      
      function showVehicleModal(vehicle = null) {
        showModal('vehicle-modal-content');
        
        // Set form title
        const title = document.getElementById('vehicle-modal-title');
        title.textContent = vehicle ? 'Editar Vehículo' : 'Agregar Vehículo';
        
        // Populate form if editing
        if (vehicle) {
          document.getElementById('modal-license-plate').value = vehicle.licensePlate;
          document.getElementById('modal-license-plate').readOnly = true; // Can't change plate when editing
          document.getElementById('modal-pilot-name').value = vehicle.pilotName;
          document.getElementById('modal-current-km').value = vehicle.currentKm;
          document.getElementById('modal-next-service-km').value = vehicle.nextServiceKm;
        } else {
          document.getElementById('modal-license-plate').readOnly = false;
          document.getElementById('vehicle-form').reset();
        }
        
        // Update form submission handler
        const form = document.getElementById('vehicle-form');
        form.onsubmit = function(e) {
          e.preventDefault();
          saveVehicle(vehicle);
        };
      }
      
      function saveVehicle(existingVehicle = null) {
        const licensePlate = document.getElementById('modal-license-plate').value;
        const pilotName = document.getElementById('modal-pilot-name').value;
        const currentKm = document.getElementById('modal-current-km').value;
        const nextServiceKm = document.getElementById('modal-next-service-km').value;
        
        // Validation
        if (!licensePlate || !pilotName || !currentKm || !nextServiceKm) {
          showToast('Por favor complete todos los campos', 'error');
          return;
        }
        
        if (parseInt(currentKm) >= parseInt(nextServiceKm)) {
          showToast('El kilometraje del próximo servicio debe ser mayor al actual', 'warning');
          return;
        }
        
        // Get existing vehicles
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        
        // Check if license plate already exists (for new vehicles)
        if (!existingVehicle && vehicles.some(v => v.licensePlate === licensePlate)) {
          showToast('Ya existe un vehículo con esta placa', 'error');
          return;
        }
        
        // Create or update vehicle
        const vehicle = {
          licensePlate: licensePlate,
          pilotName: pilotName,
          currentKm: currentKm,
          nextServiceKm: nextServiceKm,
          lastUpdated: new Date().toISOString()
        };
        
        if (existingVehicle) {
          // Update existing vehicle
          const index = vehicles.findIndex(v => v.licensePlate === licensePlate);
          if (index !== -1) {
            vehicles[index] = vehicle;
          }
        } else {
          // Add new vehicle
          vehicles.push(vehicle);
        }
        
        // Save to localStorage
        localStorage.setItem('vehicles', JSON.stringify(vehicles));
        
        // Close modal and refresh dashboard
        closeModal();
        loadDashboard();
        showToast(`Vehículo ${existingVehicle ? 'actualizado' : 'agregado'} con éxito`, 'success');
      }
      
      function editVehicle(licensePlate) {
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        const vehicle = vehicles.find(v => v.licensePlate === licensePlate);
        if (vehicle) {
          showVehicleModal(vehicle);
        }
      }
      
      function confirmDeleteVehicle(licensePlate) {
        showModal('confirm-modal-content');
        
        document.getElementById('confirm-modal-title').textContent = 'Eliminar Vehículo';
        document.getElementById('confirm-modal-message').textContent = `¿Está seguro que desea eliminar el vehículo con placa ${licensePlate}? Esta acción no se puede deshacer.`;
        
        document.getElementById('confirm-modal-cancel').addEventListener('click', closeModal);
        document.getElementById('confirm-modal-confirm').addEventListener('click', function() {
          deleteVehicle(licensePlate);
          closeModal();
        });
      }
      
      function deleteVehicle(licensePlate) {
        // Delete vehicle
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        const updatedVehicles = vehicles.filter(v => v.licensePlate !== licensePlate);
        localStorage.setItem('vehicles', JSON.stringify(updatedVehicles));
        
        // Also delete associated services
        const services = JSON.parse(localStorage.getItem('services') || '[]');
        const updatedServices = services.filter(s => s.licensePlate !== licensePlate);
        localStorage.setItem('services', JSON.stringify(updatedServices));
        
        // Refresh dashboard
        loadDashboard();
        showToast('Vehículo eliminado con éxito', 'success');
      }
      
      function showUserModal(user = null) {
        showModal('user-modal-content');
        
        // Set form title
        const title = document.getElementById('user-modal-title');
        title.textContent = user ? 'Editar Usuario' : 'Agregar Usuario';
        
        // Populate form if editing
        if (user) {
          document.getElementById('modal-fullname').value = user.fullname;
          document.getElementById('modal-username').value = user.username;
          document.getElementById('modal-username').readOnly = true; // Can't change username when editing
          document.getElementById('modal-password').value = ''; // Don't show password, require new one
          document.getElementById('modal-role').value = user.role;
        } else {
          document.getElementById('modal-username').readOnly = false;
          document.getElementById('user-form').reset();
        }
        
        // Update form submission handler
        const form = document.getElementById('user-form');
        form.onsubmit = function(e) {
          e.preventDefault();
          saveUser(user);
        };
      }
      
      function saveUser(existingUser = null) {
        const fullname = document.getElementById('modal-fullname').value;
        const username = document.getElementById('modal-username').value;
        const password = document.getElementById('modal-password').value;
        const role = document.getElementById('modal-role').value;
        
        // Validation
        if (!fullname || !username || (!existingUser && !password) || !role) {
          showToast('Por favor complete todos los campos', 'error');
          return;
        }
        
        // Get existing users
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        
        // Check if username already exists (for new users)
        if (!existingUser && users.some(u => u.username === username)) {
          showToast('Ya existe un usuario con este nombre de usuario', 'error');
          return;
        }
        
        // Create or update user
        const user = {
          fullname: fullname,
          username: username,
          password: existingUser && !password ? existingUser.password : password,
          role: role
        };
        
        if (existingUser) {
          // Update existing user
          const index = users.findIndex(u => u.username === username);
          if (index !== -1) {
            users[index] = user;
          }
        } else {
          // Add new user
          users.push(user);
        }
        
        // Save to localStorage
        localStorage.setItem('users', JSON.stringify(users));
        
        // Close modal and refresh users list
        closeModal();
        loadUsers();
        showToast(`Usuario ${existingUser ? 'actualizado' : 'agregado'} con éxito`, 'success');
      }
      
      function editUser(username) {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const user = users.find(u => u.username === username);
        if (user) {
          showUserModal(user);
        }
      }
      
      function confirmDeleteUser(username) {
        // Don't allow deleting the last admin
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const adminCount = users.filter(u => u.role === 'admin').length;
        const userToDelete = users.find(u => u.username === username);
        
        if (adminCount <= 1 && userToDelete.role === 'admin') {
          showToast('No se puede eliminar el último administrador', 'error');
          return;
        }
        
        // Prevent deleting the current user
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (currentUser.username === username) {
          showToast('No puede eliminar su propio usuario', 'error');
          return;
        }
        
        showModal('confirm-modal-content');
        
        document.getElementById('confirm-modal-title').textContent = 'Eliminar Usuario';
        document.getElementById('confirm-modal-message').textContent = `¿Está seguro que desea eliminar el usuario ${username}? Esta acción no se puede deshacer.`;
        
        document.getElementById('confirm-modal-cancel').addEventListener('click', closeModal);
        document.getElementById('confirm-modal-confirm').addEventListener('click', function() {
          deleteUser(username);
          closeModal();
        });
      }
      
      function deleteUser(username) {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const updatedUsers = users.filter(u => u.username !== username);
        localStorage.setItem('users', JSON.stringify(updatedUsers));
        
        loadUsers();
        showToast('Usuario eliminado con éxito', 'success');
      }
      
      function saveService() {
        let licensePlate = document.getElementById('license-plate').value;
        
        if (licensePlate === 'new') {
          licensePlate = document.getElementById('new-license-plate').value;
          if (!licensePlate) {
            showToast('Por favor ingrese la placa del vehículo', 'error');
            return;
          }
        }
        
        const pilotName = document.getElementById('pilot-name').value;
        const serviceDate = document.getElementById('service-date').value;
        const currentKm = document.getElementById('current-km').value;
        const nextServiceKm = document.getElementById('next-service-km').value;
        const observations = document.getElementById('service-observations').value;
        
        // Validation
        if (!licensePlate || !pilotName || !serviceDate || !currentKm || !nextServiceKm) {
          showToast('Por favor complete todos los campos obligatorios', 'error');
          return;
        }
        
        if (parseInt(currentKm) >= parseInt(nextServiceKm)) {
          showToast('El kilometraje del próximo servicio debe ser mayor al actual', 'warning');
          return;
        }
        
        // Create service record
        const service = {
          id: Date.now().toString(),
          licensePlate: licensePlate,
          pilotName: pilotName,
          serviceDate: serviceDate,
          currentKm: currentKm,
          nextServiceKm: nextServiceKm,
          observations: observations,
          createdAt: new Date().toISOString()
        };
        
        // Save service
        const services = JSON.parse(localStorage.getItem('services') || '[]');
        services.push(service);
        localStorage.setItem('services', JSON.stringify(services));
        
        // Update or create vehicle
        const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
        const vehicleIndex = vehicles.findIndex(v => v.licensePlate === licensePlate);
        
        if (vehicleIndex !== -1) {
          // Update existing vehicle
          vehicles[vehicleIndex].currentKm = currentKm;
          vehicles[vehicleIndex].nextServiceKm = nextServiceKm;
          vehicles[vehicleIndex].pilotName = pilotName;
          vehicles[vehicleIndex].lastUpdated = new Date().toISOString();
        } else {
          // Create new vehicle
          vehicles.push({
            licensePlate: licensePlate,
            pilotName: pilotName,
            currentKm: currentKm,
            nextServiceKm: nextServiceKm,
            lastUpdated: new Date().toISOString()
          });
        }
        
        localStorage.setItem('vehicles', JSON.stringify(vehicles));
        
        // Show success and return to dashboard
        showToast('Servicio registrado con éxito', 'success');
        switchPage('dashboard');
        document.querySelector('.menu-item[data-page="dashboard"]').classList.add('active');
        document.querySelector('.menu-item[data-page="service"]').classList.remove('active');
      }
      
      function saveChecklist() {
        const licensePlate = document.getElementById('checklist-license-plate').value;
        const checklistDate = document.getElementById('checklist-date').value;
        
        // Validation
        if (!licensePlate || !checklistDate) {
          showToast('Por favor seleccione la placa y la fecha', 'error');
          return;
        }
        
        // Get signature
        let signatureData = '';
        if (signaturePad && !signaturePad.isEmpty()) {
          signatureData = signaturePad.toDataURL();
        } else {
          showToast('Por favor firme la inspección', 'error');
          return;
        }
        
        // Collect checklist items
        const items = [];
        document.querySelectorAll('#checklist-items tr').forEach((row, index) => {
          const goodCheckbox = row.querySelector(`.custom-checkbox[data-status="good"]`);
          const badCheckbox = row.querySelector(`.custom-checkbox[data-status="bad"]`);
          const naCheckbox = row.querySelector(`.custom-checkbox[data-status="na"]`);
          const observation = row.querySelector('input[type="text"]').value;
          
          let status = 'unchecked';
          if (goodCheckbox.classList.contains('checked')) status = 'good';
          else if (badCheckbox.classList.contains('checked')) status = 'bad';
          else if (naCheckbox.classList.contains('checked')) status = 'na';
          
          items.push({
            item: document.querySelectorAll('#checklist-items tr')[index].cells[0].textContent,
            status: status,
            observation: observation
          });
        });
        
        // Create checklist record
        const checklist = {
          id: Date.now().toString(),
          licensePlate: licensePlate,
          date: checklistDate,
          items: items,
          signature: signatureData,
          createdAt: new Date().toISOString()
        };
        
        // Save checklist
        const checklists = JSON.parse(localStorage.getItem('checklists') || '[]');
        checklists.push(checklist);
        localStorage.setItem('checklists', JSON.stringify(checklists));
        
        // Show success and return to dashboard
        showToast('Inspección guardada con éxito', 'success');
        switchPage('dashboard');
        document.querySelector('.menu-item[data-page="dashboard"]').classList.add('active');
        document.querySelector('.menu-item[data-page="checklist"]').classList.remove('active');
      }
      
      // Toast notification function
      function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const icon = document.getElementById('toast-icon');
        const messageElement = document.getElementById('toast-message');
        
        // Set icon and color based on type
        if (type === 'success') {
          toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg bg-green-500 text-white flex items-center animate__animated animate__fadeInUp z-50';
          icon.className = 'fas fa-check-circle mr-2';
        } else if (type === 'error') {
          toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg bg-red-500 text-white flex items-center animate__animated animate__fadeInUp z-50';
          icon.className = 'fas fa-times-circle mr-2';
        } else if (type === 'warning') {
          toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg bg-yellow-500 text-white flex items-center animate__animated animate__fadeInUp z-50';
          icon.className = 'fas fa-exclamation-circle mr-2';
        } else if (type === 'info') {
          toast.className = 'fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg bg-blue-500 text-white flex items-center animate__animated animate__fadeInUp z-50';
          icon.className = 'fas fa-info-circle mr-2';
        }
        
        messageElement.textContent = message;
        toast.classList.remove('hidden');
        
        // Hide after 3 seconds
        setTimeout(() => {
          toast.classList.add('animate__fadeOutDown');
          setTimeout(() => {
            toast.classList.add('hidden');
            toast.classList.remove('animate__fadeOutDown');
          }, 300);
        }, 3000);
      }
    });
  </script>
</body>
</html>
